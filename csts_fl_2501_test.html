<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <!-- 모바일 기기에서 화면 너비에 맞춰 스케일링 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSTS FL 2025년 1회</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            margin: 0;
            padding: 0;
            background: #f4f4f4;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 1rem;
            text-align: center;
        }
        
        /* nav-tabs 전체에 테두리 + 라운딩 */
        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 10px;
            background: #fff;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            padding: 0.5rem 1rem;

            /* 추가된 부분: 테두리와 둥근 모서리 */
            border: 1px solid #eaeaea;
            border-radius: 10px;
        }

        .nav-tabs a {
            display: inline-block;
            color: #333;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 500;
            transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;

            /* 메뉴 항목에도 옅은 테두리 */
            border: 1px solid #ddd;
            background: #fff; /* hover 이전 기본 배경 */
        }
        .nav-tabs a:hover {
            background: #f1f1f1;
            transform: translateY(-1px);
        }
        .nav-tabs a.active {
            background: #007bff;
            color: #fff;

            /* 활성화 상태일 때 테두리 색상도 강조 */
            border-color: #007bff;

            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
        .print-view .header,
        .print-view .nav-tabs {
            display: none;
        }
        .content {
            padding: 2rem;
        }

        @media (max-width: 600px) {
          .nav-tabs {
            flex-wrap: wrap;
            padding: 0.5rem;
          }
          .nav-tabs a {
            margin: 2px;
            font-size: 14px;
          }
          .content {
            padding: 1rem;
          }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1></h1>
    </div>
    <div class="nav-tabs">
      <a href="csts_fl_2501_test.html"  class="active">
           FL 2025년 1회 주관식</a>
        <a href="csts_fl_2405.html" >
           FL 2024년 5회 </a>
        <a href="csts_fl_2404.html" >
           FL 2024년 4회 </a>
        <a href="csts_fl_2403.html" >
           FL 2024년 3회 </a>
        <a href="csts_fl_2402.html" >
           FL 2024년 2회 </a>
        <a href="csts_fl_2401.html" >
           FL 2024년 1회 </a>
        <a href="csts_al_2402.html" >
           AL 2024년 2회 </a>
        <a href="csts_al_2401.html" >
           AL 2024년 1회 </a>
    </div>
    <div class="content">
        
<style>
  /* 퀴즈 전용 스타일 */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  .quiz-container {
    max-width: 800px;
    margin: 0 auto;
    background: #fff;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  .settings {
    display: flex;
    align-items: center;
    justify-content: space-between; /* 좌우로 배치 */
    background: #f9f9f9;
    border-radius: 8px;
    padding: 10px 15px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  .settings label {
    font-weight: 500;
    margin-right: 6px;
  }
  .settings select {
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 5px 8px;
    font-size: 14px;
    outline: none;
    transition: box-shadow 0.2s;
  }
  .settings select:focus {
    box-shadow: 0 0 0 2px rgba(0,120,212,0.2);
  }
  .page-nav-buttons {
  margin-left: auto; /* 오른쪽으로 밀기 */
  display: flex;
  gap: 10px;
}
.page-nav-buttons button {
  background: linear-gradient(to right, #a3d8f4, #b5e7f7);
  color: #333; /* 흰색 대신 약간 어두운 폰트로 가독성 ↑ */
  border: none;
  padding: 6px 12px;
  border-radius: 25px; /* 기존 둥근 모양 유지 */
  cursor: pointer;
  font-size: 14px;
  transition: transform 0.2s ease, background 0.3s ease;
}
.page-nav-buttons button:hover {
  transform: scale(1.05);
  background: linear-gradient(to right, #b5e7f7, #a3d8f4); /* 반대로 그라디언트 */
}
  .question {
    margin-bottom: 25px;
    padding: 20px;
    border-bottom: 1px solid #eee;
  }
  .question-text {
    font-weight: 500;
    margin-bottom: 15px;
  }
  .options {
    margin-left: 20px;
  }
  .option {
    margin: 10px 0;
    padding: 10px;
    border-radius: 5px;
    transition: background 0.3s ease;
  }
  .option:hover {
    background-color: #f0f0f0;
  }
  .result {
    margin-top: 15px;
    padding: 10px;
    border-radius: 4px;
    display: block;
  }
  .message {
    margin-top: 10px;
    padding: 10px;
    border-radius: 4px;
    background-color: #f8f9fa;
  }
  .question-buttons {
    margin-top: 15px;
    display: flex;
    gap: 15px;
    justify-content: flex-end;
  }
  .check-button,
  .reset-button {
    padding: 8px 20px;
    border-radius: 25px;
    border: none;
    color: #fff;
    font-size: 14px;
    cursor: pointer;
    transition: transform 0.2s ease, background 0.3s ease;
  }
  .check-button {
    background: linear-gradient(to right, #a3d8f4, #91c9e8);
  }
  .reset-button {
    background: linear-gradient(to right, #f5a3a3, #e88f8f);
  }
  .check-button:hover,
  .reset-button:hover {
    transform: scale(1.05);
    filter: brightness(1.1);
  }
  .navigation {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #ddd;
    flex-wrap: nowrap;
  }
  .navigation button {
  background: linear-gradient(to right, #a3d8f4, #b5e7f7);
  color: #333;
  border: none;
  padding: 10px 25px;
  border-radius: 30px;
  font-size: 16px;
  cursor: pointer;
  transition: transform 0.2s ease, background 0.3s ease;
  white-space: nowrap;
}
.navigation button:hover {
  transform: scale(1.05);
  background: linear-gradient(to right, #b5e7f7, #a3d8f4);
}
  .progress-bar {
    margin: 20px 0;
    height: 25px;
    background: #f0f0f0;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
    position: relative;
  }
  .progress {
    height: 100%;
    background: #0078d4;
    transition: width 0.4s ease-in-out;
    width: 0;
    border-radius: 15px 0 0 15px;
  }
  .progress-text {
    position: absolute;
    width: 100%;
    top: 0;
    left: 0;
    text-align: center;
    line-height: 25px;
    color: #848383;
    font-size: 16px;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
    z-index: 1;
  }
  .correct {
    background-color: #e6ffe6;
    color: #006400;
    border: 1px solid #006400;
  }
  .option.correct-answer {
    background-color: #e6ffe6;
    border-left: 3px solid #006400;
  }
  .correct-answer {
    background-color: #dff0d8 !important;
    border: 1px solid #3c763d !important;
    padding: 5px;
    border-radius: 4px;
  }
  .wrong-answer {
    background-color: #f2dede !important;
    border: 1px solid #a94442 !important;
    padding: 5px;
    border-radius: 4px;
  }
  .incorrect {
    background-color: #ffe6e6;
    color: #640000;
    border: 1px solid #640000;
  }
  .explanation {
    margin-top: 15px;
    padding: 15px 20px;
    background-color: #e7f5ff;
    border: 2px solid #0078d4;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    font-size: 16px;
    color: #333;
    display: none;
    opacity: 0;
    transition: opacity 0.5s ease, transform 0.5s ease;
    transform: translateY(-10px);
  }
  .explanation.visible {
    display: block !important;
    opacity: 1;
    transform: translateY(0);
  }
  #scrollTopBtn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #0078d4;
  color: #fff;
  border: none;
  padding: 10px 15px;
  border-radius: 5px;
  cursor: pointer;
  display: none; /* 초기에는 숨김 */
  z-index: 1000;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  transition: opacity 0.3s ease;
}
  /* 이미지를 화면 너비에 맞게 축소, 클릭 시 포인터 표시 */
  .quiz-container img {
    max-width: 100%;
    height: auto;
    cursor: pointer;
  }

  @media (max-width: 600px) {
    .quiz-container {
      max-width: 100%;
      margin: 0;
      padding: 20px;
    }
    .settings {
    flex-direction: row;  /* column -> row 로 변경 */
    flex-wrap: nowrap;    /* 줄바꿈 방지 */
    justify-content: space-between;
    align-items: center;
  }
  .page-nav-buttons {
    margin-top: 0;       /* 필요하면 제거 */
  }
    .navigation {
      flex-wrap: wrap;
      justify-content: center; /* 버튼 가로 중앙정렬 */
    }
    .navigation button {
      margin: 5px 5px; /* 버튼 간격 */
      font-size: 14px; /* 조금 더 작은 폰트 */
    }
    .question {
      margin-bottom: 15px;
      padding: 10px;
    }
    .question-text {
      font-size: 16px;
    }
    .options {
      margin-left: 0;
    }
    .option {
      margin: 8px 0;
      padding: 8px;
    }
    .check-button,
    .reset-button {
      font-size: 13px;
      padding: 6px 12px;
    }
    .progress-text {
      font-size: 14px;
    }
  }
  @media (max-width: 400px) {
    .question-text {
      font-size: 15px;
    }
    .check-button,
    .reset-button {
      font-size: 12px;
      padding: 5px 10px;
    }
    .navigation button {
      font-size: 13px;
      padding: 8px 15px;
    }
  }
</style>

<div class="quiz-container">
  <h1></h1>
  <div class="settings">
    <label for="questionsPerPageSelect">페이지당 문항 수:</label>
    <select id="questionsPerPageSelect">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="10" selected>10</option>
    </select>
    <span class="page-nav-buttons">
      <button onclick="prevPage()" id="prevPageBtn">◀</button>
      <button onclick="nextPage()" id="nextPageBtn">▶</button>
      <input type="number" id="questionNumberInput" placeholder="문제번호 입력" min="1" style="width:80px; margin-left: 10px;">
      <button onclick="jumpToQuestion()">이동</button>
    </span>
  </div>
  <div class="progress-bar">
    <div class="progress" id="progress"></div>
    <div id="progress-text" class="progress-text"></div>
  </div>
  <div id="questions"></div>
  <div class="navigation">
    <button onclick="prevPage()" id="prevButton">◀</button>
    <button onclick="checkAnswers()" id="checkButton">정답 확인</button>
    <button onclick="resetQuiz()" id="resetButton">리셋</button>
    <button onclick="nextPage()" id="nextButton">▶</button>
    <button onclick="scrollToTop()" id="scrollTopBtn">▲ Top</button>
  </div>
  <div id="score"></div>
</div>

<script src="static/js/cstsfl_2501_quizData_test.inc.js"></script>
<script>
  let QUESTIONS_PER_PAGE = 10;
  let currentPage = 0;
  let currentQuestions = [];
  let totalScore = 0;
  // 사용자가 입력한 값을 저장할 객체 : 250328 heina
  const userAnswers = {};
  
  // 이미지 클릭 시 새 탭으로 열기
  function showFullSizeImage(src) {
    window.open(src, '_blank');
  }

  function jumpToQuestion() {
  const input = document.getElementById('questionNumberInput');
  const questionNum = parseInt(input.value);
  if (isNaN(questionNum) || questionNum < 1 || questionNum > cstsfl_2501_quizData_test.length) {
    alert('올바른 문제 번호를 입력하세요. (1 ~ ' + cstsfl_2501_quizData_test.length + ')');
    return;
  }
  
  // 문제 번호에 따른 페이지 계산 (0부터 시작하는 페이지 인덱스)
  currentPage = Math.floor((questionNum - 1) / QUESTIONS_PER_PAGE);
  updateCurrentQuestions();
  displayQuestions();
  updateNavigation();
  updateProgress();
  resetQuiz();
  
  // 페이지 내에서 해당 문제 인덱스 (0부터 시작)
  const questionIndex = (questionNum - 1) % QUESTIONS_PER_PAGE;
  // 해당 문제 요소를 찾아 스크롤 이동
  const questionElements = document.querySelectorAll('.question');
  if (questionElements && questionElements[questionIndex]) {
    questionElements[questionIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
    // 원한다면 해당 문제에 하이라이트 효과를 줄 수도 있습니다.
    questionElements[questionIndex].classList.add('highlight');
    setTimeout(() => {
      questionElements[questionIndex].classList.remove('highlight');
    }, 2000);
  }
}


  // 문제 내 이미지를 <img> 태그로 치환하며, onclick 이벤트를 주어 원본 보기 가능하게 함
  function replaceImageTags(text) {
    return text.replace(
      /\[([^\]]+\.(?:jpg|png|jpeg|gif))\]/gi,
      '<img src="img/$1" alt="$1" onclick=\'showFullSizeImage("img/$1")\' />'
    );
  }

  // 해설 텍스트(설명)에 포함된 이미지도 동일한 방식으로 처리
  function processExplanation(text) {
    const items = text.split('||').map(item => item.trim());
    const imageRegex = /^[^\s]+\.(?:jpg|jpeg|png|gif)$/i;

    const htmlItems = items.map(item => {
      if (item.includes('<br>')) {
        // "이미지파일 <br> 설명" 형태로 나눠서 처리
        const parts = item.split('<br>').map(part => part.trim());
        const imagePart = parts[0];
        const captionPart = parts.slice(1).join('<br>');

        if (imageRegex.test(imagePart)) {
                return `
                    <div style="display: inline-block; text-align: center; margin: 10px;">
                        <img src="img/${imagePart}" alt="${imagePart}" 
                             style="cursor:pointer; max-width:100%; height:auto;"
                             onclick='showFullSizeImage("img/${imagePart}")' />
                    </div>
                    <div style="margin-top: 5px;">${captionPart}</div>
                `;
       } else {
                return replaceImageTags(item);
        }


      } else {
        // "<br>"가 없는 단일 항목
        if (imageRegex.test(item)) {
          return `<img src="img/${item}" alt="${item}" style="cursor:pointer;"
                  onclick='showFullSizeImage("img/${item}")' />`;
        } else {
          return replaceImageTags(item);
        }
      }
    });

    return htmlItems.join('<br>');
  }

  document.getElementById('questionsPerPageSelect').addEventListener('change', function(){
      QUESTIONS_PER_PAGE = parseInt(this.value);
      currentPage = 0;
      updateCurrentQuestions();
      displayQuestions();
      updateNavigation();
      updateProgress();
      resetQuiz();
  });

  function initializeQuiz() {
    updateCurrentQuestions();
    displayQuestions();
    updateNavigation();
    updateProgress();
  }

  function loadQuestionSet() {
    const startIdx = currentPage * QUESTIONS_PER_PAGE;
    const endIdx = Math.min(startIdx + QUESTIONS_PER_PAGE, cstsfl_2501_quizData_test.length);
    currentQuestions = cstsfl_2501_quizData_test.slice(startIdx, endIdx);
    displayQuestions();
    updateCurrentQuestions();
  }

  function updateNavigation() {
    const prevButton = document.getElementById('prevButton');
    const nextButton = document.getElementById('nextButton');
    if (prevButton) {
      prevButton.disabled = (currentPage === 0);
    }
    if (nextButton) {
      nextButton.disabled = (currentPage === Math.ceil(cstsfl_2501_quizData_test.length / QUESTIONS_PER_PAGE) - 1);
    }
  }

  function updateProgress() {
    const progressElement = document.getElementById('progress');
    const totalPages = Math.ceil(cstsfl_2501_quizData_test.length / QUESTIONS_PER_PAGE);
    let progressPercent = ((currentPage + 1) / totalPages) * 100;
    progressElement.style.width = progressPercent + '%';

    const totalQuestions = cstsfl_2501_quizData_test.length;
    const startQuestion = currentPage * QUESTIONS_PER_PAGE + 1;
    const endQuestion = Math.min((currentPage + 1) * QUESTIONS_PER_PAGE, totalQuestions);

    if (startQuestion === endQuestion) {
      document.getElementById('progress-text').textContent = `문항 ${startQuestion} / ${totalQuestions}`;
    } else {
      document.getElementById('progress-text').textContent = `문항 ${startQuestion}-${endQuestion} / ${totalQuestions}`;
    }
  }

  function showAnswers() {
    currentQuestions.forEach((q, index) => {
      const optionsContainer = document.querySelector(`#q${index}o0`).closest('.question').querySelector('.options');
      q.options.forEach((option, i) => {
        if (option.right) {
          const optionElement = optionsContainer.children[i];
          optionElement.classList.add('correct-answer');
        }
      });
      document.getElementById(`explanation${index}`).classList.add('visible');
    });
  }

  function generateOptions(question, questionIndex) {
    return question.options.map((option, optionIndex) => `
      <div class="option">
        <input type="${question.type}"
               name="q${questionIndex}"
               value="${optionIndex}"
               id="q${questionIndex}o${optionIndex}">
        <label for="q${questionIndex}o${optionIndex}">${option.value}</label>
      </div>
    `).join('');
  }
  
  function displayQuestions() {
    const questionsContainer = document.getElementById('questions');
    questionsContainer.innerHTML = '';
    const startNumber = currentPage * QUESTIONS_PER_PAGE + 1;
    
    currentQuestions.forEach((q, index) => {
    const questionDiv = document.createElement('div');
    questionDiv.className = 'question';
    
    const questionNumber = startNumber + index;
    // 문제 텍스트 내 이미지 태그 치환
    const processedQuestion = replaceImageTags(q.question);
    // 해설 텍스트 내 이미지 태그 치환
    const processedExplanation = processExplanation(q.explanation);
    
    let optionsHTML = ''; //generateOptions(q, index);
    
    let inputFieldHTML = ''; //20250328 heina

    // 페이지당 1문항일 때 개별 버튼 감추기(선택 사항)
    let questionButtonsHTML = '';
    if (QUESTIONS_PER_PAGE !== 1) {
        questionButtonsHTML = `
          <div class="question-buttons">
            <button onclick="checkSingleAnswer(${index})" class="check-button">정답 확인</button>
            <button onclick="resetSingleQuestion(${index})" class="reset-button">리셋</button>
          </div>
        `;
    }

    // 주관식 문제 처리 : 20250328 heina
    if (q.type === 'text') {
        inputFieldHTML = `
            <input type="text" id="question${index}" placeholder="답을 입력하세요">
        `;
        optionsHTML = ''; // 주관식 문제일 경우 optionsHTML 초기화
    }
    else{
        optionsHTML = generateOptions(q, index);
    }
      
    questionDiv.innerHTML = `
        <div class="question-text">[${questionNumber}] ${processedQuestion}</div>
        <div class="options">${optionsHTML}</div>
        ${inputFieldHTML}
        ${questionButtonsHTML}
        <div class="result" id="result${index}"></div>
        <div class="message" id="message${index}" style="display: none;"></div>
        <div class="explanation" id="explanation${index}">
          ${processedExplanation}
        </div>
        `;

      questionsContainer.appendChild(questionDiv);
    });
  }

  function checkSingleAnswer(index) {
    const q = currentQuestions[index];
    const resultDiv = document.getElementById(`result${index}`);
    const messageDiv = document.getElementById(`message${index}`);
    const explanationDiv = document.getElementById(`explanation${index}`);
    let isCorrect = false;
    let message = '';

    if (q.type === 'radio') {
      const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
      if (!selectedOption) {
        message = '답을 선택하지 않았습니다.';
        messageDiv.innerHTML = `정답은 "${q.options[q.correct].value}" 입니다.`;
        const correctOptionElement = document.getElementById(`q${index}o${q.correct}`);
        if (correctOptionElement) {
          correctOptionElement.closest('.option').classList.add('correct-answer');
        }
      } else {
        isCorrect = Number(selectedOption.value) === q.correct;
        handleResult(isCorrect, selectedOption, q, index);
      }
    } else if (q.type === 'checkbox') {
      const selectedOptions = Array.from(document.querySelectorAll(`input[id^="q${index}o"]:checked`))
        .map(input => Number(input.id.slice(-1)));

      if (selectedOptions.length === 0) {
        message = '답을 선택하지 않았습니다.';
        messageDiv.innerHTML = `정답은 ${q.correct.map(i => `"${q.options[i].value}"`).join(', ')} 입니다.`;
        q.correct.forEach(correctIndex => {
          const correctElement = document.getElementById(`q${index}o${correctIndex}`);
          if (correctElement) {
            correctElement.closest('.option').classList.add('correct-answer');
          }
        });
      } else {
        isCorrect = arraysEqual(selectedOptions.sort(), q.correct.sort());
        handleCheckboxResult(isCorrect, selectedOptions, q, index);
      }
    }
    // 주관식 답 체크 : 20250328 heina
    else if (q.type === 'text') {
      const userAnswer = document.getElementById(`question${index}`).value.trim();

      if (userAnswer === '') {
        message = '답을 입력하지 않았습니다.';
        if (Array.isArray(q.correct)) {
            messageDiv.innerHTML = `정답은 '${q.correct.join(' | ')}' 입니다.`;
        } else {
            messageDiv.innerHTML = `정답은 '${q.correct}' 입니다.`;
        }
      } else {
        isCorrect = q.correct.includes(userAnswer);
        handleTextResult(isCorrect, userAnswer, q, index);
      }
    }
    showResult(resultDiv, messageDiv, explanationDiv, isCorrect, message);
  }

  function showResult(resultDiv, messageDiv, explanationDiv, isCorrect, message) {
    resultDiv.textContent = message || (isCorrect ? '정답입니다!' : '틀렸습니다.');
    resultDiv.style.color = isCorrect ? 'blue' : 'red';
    resultDiv.style.display = 'block';
    messageDiv.style.display = 'block';
    messageDiv.style.color = 'red';
    explanationDiv.classList.add('visible');
  }

  function handleResult(isCorrect, selectedOption, q, index) {
    const messageDiv = document.getElementById(`message${index}`);

    if (isCorrect) {
      messageDiv.innerHTML = '';
      selectedOption.closest('.option').classList.add('correct-answer');
    } else {
      messageDiv.innerHTML = `정답은 "${q.options[q.correct].value}" 입니다.`;
      selectedOption.closest('.option').classList.add('wrong-answer');
    }
    const correctOptionElement = document.getElementById(`q${index}o${q.correct}`);
    if (correctOptionElement) {
      correctOptionElement.closest('.option').classList.add('correct-answer');
    }
  }

  function checkAnswers() {
    let score = 0;
    document.querySelectorAll('.option').forEach(option => {
      option.classList.remove('correct-answer', 'wrong-answer');
    });

    currentQuestions.forEach((q, index) => {
      const resultDiv = document.getElementById(`result${index}`);
      const messageDiv = document.getElementById(`message${index}`);
      const explanationDiv = document.getElementById(`explanation${index}`);
      if (!resultDiv || !messageDiv || !explanationDiv) return;

      let isCorrect = false;
      let message = '';

      if (q.type === 'radio') {
        const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
        const correctOptionElement = document.getElementById(`q${index}o${q.correct}`);

        if (!selectedOption) {
          message = '답을 선택하지 않았습니다.';
          messageDiv.innerHTML = `정답은 "${q.options[q.correct].value}" 입니다.`;
        } else {
          isCorrect = Number(selectedOption.value) === q.correct;
          if (isCorrect) {
            message = '정답입니다!';
            messageDiv.innerHTML = '';
            selectedOption.closest('.option').classList.add('correct-answer');
          } else {
            message = '틀렸습니다.';
            messageDiv.innerHTML = `정답은 "${q.options[q.correct].value}" 입니다.`;
            selectedOption.closest('.option').classList.add('wrong-answer');
          }
        }
        if (correctOptionElement) {
          correctOptionElement.closest('.option').classList.add('correct-answer');
        }
        if (isCorrect) score++;
      } else if (q.type === 'checkbox') {
        const selectedOptions = Array.from(document.querySelectorAll(`input[id^="q${index}o"]:checked`))
          .map(input => Number(input.id.slice(-1)));

        if (selectedOptions.length === 0) {
          message = '답을 선택하지 않았습니다.';
          messageDiv.innerHTML = `정답은 ${q.correct.map(i => `"${q.options[i].value}"`).join(', ')} 입니다.`;

        } else {
          isCorrect = arraysEqual(selectedOptions.sort(), q.correct.sort());
          if (isCorrect) {
            message = '정답입니다!';
            messageDiv.innerHTML = '';
          } else {
            message = '틀렸습니다.';
            messageDiv.innerHTML = `정답은 ${q.correct.map(i => `"${q.options[i].value}"`).join(', ')} 입니다.`;

            selectedOptions.forEach(sel => {
              if (!q.correct.includes(sel)) {
                const element = document.querySelector(`#q${index}o${sel}`);
                if (element) {
                  element.closest('.option').classList.add('wrong-answer');
                }
              }
            });
          }
        }
        q.correct.forEach(correctIndex => {
          const correctElement = document.getElementById(`q${index}o${correctIndex}`);
          if (correctElement) {
            correctElement.closest('.option').classList.add('correct-answer');
          }
        });
        if (isCorrect) score++;
      }
      // 주관식 답 체크 : 20250328 heina
      else if (q.type === 'text') {
        const userAnswer = document.getElementById(`question${index}`).value.trim();
        let isCorrect = false;
        // let message = '';
    
        if (userAnswer === '') {
            message = '답을 입력하지 않았습니다.';
            if (Array.isArray(q.correct)) {
                messageDiv.innerHTML = `정답은 '${q.correct.join(' | ')}' 입니다.`;
            } else {
                messageDiv.innerHTML = `정답은 '${q.correct}' 입니다.`;
            }
        } else {
            if (Array.isArray(q.correct)) {
                isCorrect = q.correct.includes(userAnswer);
            } else {
                isCorrect = userAnswer === q.correct;
            }
    
            if (isCorrect) {
                message = '정답입니다!';
                messageDiv.innerHTML = '';
            } else {
                message = '틀렸습니다.';
                if (Array.isArray(q.correct)) {
                    messageDiv.innerHTML = `정답은 '${q.correct.join(' | ')}' 입니다.`;
                } else {
                    messageDiv.innerHTML = `정답은 '${q.correct}' 입니다.`;
                }
            }
        }
        if (isCorrect) score++;
      }
        
      resultDiv.textContent = message;
      resultDiv.style.color = isCorrect ? 'blue' : 'red';
      resultDiv.style.display = 'block';
      messageDiv.style.display = 'block';
      messageDiv.style.color = 'red';
      explanationDiv.classList.add('visible');
    });

    totalScore = score;
    const scoreElement = document.getElementById('score');
    if (scoreElement) {
      scoreElement.textContent = `점수: ${score}/${currentQuestions.length}`;
    }
  }

  function arraysEqual(arr1, arr2) {
    if (arr1.length !== arr2.length) return false;
    return arr1.every((val, idx) => val === arr2[idx]);
  }

  function updateCurrentQuestions() {
    const start = currentPage * QUESTIONS_PER_PAGE;
    const end = Math.min(start + QUESTIONS_PER_PAGE, cstsfl_2501_quizData_test.length);
    currentQuestions = cstsfl_2501_quizData_test.slice(start, end);
  }

  function resetQuiz() {
    currentQuestions.forEach((q, index) => {
      const inputs = document.querySelectorAll(`input[id^="q${index}"]`);
      const resultDiv = document.getElementById(`result${index}`);
      const messageDiv = document.getElementById(`message${index}`);
      const explanationDiv = document.getElementById(`explanation${index}`);

      inputs.forEach(input => {
        input.checked = false;
        input.closest('.option').classList.remove('correct-answer', 'wrong-answer');
      });

      if (resultDiv) resultDiv.textContent = '';
      if (messageDiv) {
        messageDiv.textContent = '';
        messageDiv.style.display = 'none';
      }
      if(explanationDiv) explanationDiv.classList.remove('visible');
    });

    totalScore = 0;
    const scoreElement = document.getElementById('score');
    if (scoreElement) {
      scoreElement.textContent = '점수: 0/0';
    }
  }

  function prevPage() {
    if (currentPage > 0) {
      currentPage--;
      updateCurrentQuestions();
      displayQuestions();
      updateNavigation();
      updateProgress();
      resetQuiz();
      scrollToTop();
    }
  }

  function nextPage() {
    const maxPage = Math.ceil(cstsfl_2501_quizData_test.length / QUESTIONS_PER_PAGE) - 1;
    if (currentPage < maxPage) {
      currentPage++;
      updateCurrentQuestions();
      displayQuestions();
      updateNavigation();
      updateProgress();
      resetQuiz();
      scrollToTop()
    }
  }

  function handleCheckboxResult(isCorrect, selectedOptions, q, index) {
    const messageDiv = document.getElementById(`message${index}`);

    if (isCorrect) {
      messageDiv.innerHTML = '';
    } else {
      messageDiv.innerHTML = `정답은 ${q.correct.map(i => `"${q.options[i].value}"`).join(', ')} 입니다.`;
      selectedOptions.forEach(sel => {
        if (!q.correct.includes(sel)) {
          const element = document.querySelector(`#q${index}o${sel}`);
          if (element) {
            element.closest('.option').classList.add('wrong-answer');
          }
        }
      });
    }
    q.correct.forEach(correctIndex => {
      const correctElement = document.getElementById(`q${index}o${correctIndex}`);
      if (correctElement) {
        correctElement.closest('.option').classList.add('correct-answer');
      }
    });
  }

  function handleTextResult(isCorrect, q, index) { // 주관식 : 20250328 heina
    const messageDiv = document.getElementById(`message${index}`);

     if (q.type === 'text') { // 주관식 처리
        if (isCorrect) {
            messageDiv.innerHTML = '';
        } else {
            if (Array.isArray(q.correct)) {
                messageDiv.innerHTML = `정답은 '${q.correct.join(' | ')}' 입니다.`;
            } else {
                messageDiv.innerHTML = `정답은 '${q.correct}' 입니다.`;
            }
        }
        return; // 주관식 문제이므로 추가 처리는 필요하지 않음
    }
  }

// 스크롤 이벤트 감지하여 버튼 표시 여부 결정
window.addEventListener("scroll", function() {
  const btn = document.getElementById("scrollTopBtn");
  if (window.pageYOffset > 300) {
    btn.style.display = "block";
  } else {
    btn.style.display = "none";
  }
});

// 버튼 클릭 시 페이지 최상단으로 부드럽게 스크롤
function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
  function resetSingleQuestion(index) {
    const inputs = document.querySelectorAll(`input[id^="q${index}"]`);
    const resultDiv = document.getElementById(`result${index}`);
    const messageDiv = document.getElementById(`message${index}`);
    const explanationDiv = document.getElementById(`explanation${index}`);

    inputs.forEach(input => {
      input.checked = false;
      input.closest('.option').classList.remove('correct-answer', 'wrong-answer');
    });

    if (resultDiv) resultDiv.textContent = '';
    if (messageDiv) {
      messageDiv.textContent = '';
      messageDiv.style.display = 'none';
    }
    if(explanationDiv) explanationDiv.classList.remove('visible');
  }

  document.addEventListener('DOMContentLoaded', initializeQuiz);
</script>

    </div>
</body>
</html>
